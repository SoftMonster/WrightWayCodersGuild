<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChatGPT Client</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f7f9fc;
      color: #333;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      background: #4f46e5;
      color: white;
      padding: 1rem 2rem;
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      box-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 720px;
      margin: 1rem auto;
      width: 100%;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 14px rgb(0 0 0 / 0.1);
      overflow: hidden;
    }
    #chat {
      flex: 1;
      padding: 1rem 1.5rem;
      overflow-y: auto;
      border-bottom: 1px solid #e2e8f0;
      scroll-behavior: smooth;
      display: flex;
      flex-direction: column;
    }
    p.user {
      margin: 0 0 1rem;
      padding: 0.5rem 1rem;
      border-radius: 12px;
      background: #4f46e5;
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 2px;
      max-width: 80%;
      line-height: 1.4;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    form {
      display: flex;
      padding: 1rem 1.5rem;
      background: #fafafa;
    }
    #userInput {
      flex: 1;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border: 1.5px solid #d1d5db;
      border-radius: 9999px;
      outline-offset: 2px;
      transition: border-color 0.2s;
    }
    #userInput:focus {
      border-color: #4f46e5;
    }
    button#sendBtn {
      margin-left: 1rem;
      background: #4f46e5;
      border: none;
      color: white;
      font-weight: 600;
      padding: 0 1.5rem;
      border-radius: 9999px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    button#sendBtn:hover:not(:disabled) {
      background: #4338ca;
    }
    button#sendBtn:disabled {
      background: #a5b4fc;
      cursor: not-allowed;
    }
    #apiKeyContainer {
      max-width: 720px;
      margin: 1rem auto 0.25rem;
      padding: 0 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    #apiKey {
      flex: 1;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: 1.5px solid #d1d5db;
      border-radius: 8px;
    }
    #apiKey:focus {
      border-color: #4f46e5;
      outline-offset: 2px;
    }
    label[for="apiKey"] {
      font-weight: 600;
      color: #374151;
      white-space: nowrap;
    }
    #apiKeyHelp {
      max-width: 720px;
      margin: 0 auto 1rem;
      padding: 0 1rem;
      font-size: 0.9rem;
      color: #4f46e5;
      text-align: center;
    }
    #apiKeyHelp a {
      color: #4f46e5;
      text-decoration: underline;
    }
    #apiKeyHelp a:hover {
      color: #4338ca;
    }
    #chat::-webkit-scrollbar {
      width: 8px;
    }
    #chat::-webkit-scrollbar-thumb {
      background-color: #cbd5e1;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<header>ChatGPT Client</header>

<div id="apiKeyContainer">
  <label for="apiKey">OpenAI API Key:</label>
  <input type="password" id="apiKey" placeholder="Enter your API key here" autocomplete="off" />
</div>
<div id="apiKeyHelp">
  Don't have an API key? Get one from <a href="https://platform.openai.com/account/api-keys" target="_blank" rel="noopener noreferrer">OpenAI API Keys</a>.
</div>

<main>
  <div id="chat" role="log" aria-live="polite" aria-relevant="additions"></div>
  
  <form id="chatForm" onsubmit="event.preventDefault(); sendMessage();">
    <input
      type="text"
      id="userInput"
      placeholder="Type your message..."
      autocomplete="off"
      aria-label="Type your message"
      required
      spellcheck="false"
    />
    <button type="submit" id="sendBtn">Send</button>
  </form>
</main>

<script>
  let messages = [];

  function setCookie(name, value, days) {
    const expires = new Date(Date.now() + days * 864e5).toUTCString();
    document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/';
  }

  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, (m) => ({
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    })[m]);
  }

  async function sendMessage() {
    const apiKeyInput = document.getElementById("apiKey");
    const apiKey = apiKeyInput.value.trim();
    const input = document.getElementById("userInput");
    const chat = document.getElementById("chat");
    const userMessage = input.value.trim();
    if (!apiKey || !userMessage) return;

    setCookie("openai_api_key", apiKey, 7);

    messages.push({ role: "user", content: userMessage });
    chat.innerHTML += `<p class="user"><strong>You:</strong> ${escapeHtml(userMessage)}</p>`;
    input.value = "";
    input.disabled = true;

    if (!messages.find(m => m.role === "system")) {
      messages.unshift({
        role: "system",
        content: "Always respond with a single HTML <div> that you fully control, including all class, inline styles, and structure. Do not use markdown. Do not explain. Just return one complete div."
      });
    }

    try {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${apiKey}`,
        },
        body: JSON.stringify({
          model: "gpt-4",
          messages: messages,
          temperature: 0.7,
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        chat.innerHTML += `<p class="user"><strong>Error:</strong> ${escapeHtml(errorData.error.message || response.statusText)}</p>`;
      } else {
        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content;
        if (reply) {
          messages.push({ role: "assistant", content: reply });
          chat.insertAdjacentHTML("beforeend", reply);
        } else {
          chat.innerHTML += `<p class="user"><strong>Error:</strong> Unexpected response structure.</p>`;
        }
      }
    } catch (err) {
      chat.innerHTML += `<p class="user"><strong>Error:</strong> ${escapeHtml(err.message)}</p>`;
    } finally {
      input.disabled = false;
      chat.scrollTop = chat.scrollHeight;
    }
  }
</script>

</body>
</html>
